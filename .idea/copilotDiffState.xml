<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/achacynthia/phonemanagerapp/MainActivity.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/achacynthia/phonemanagerapp/MainActivity.kt" />
              <option name="originalContent" value="package com.achacynthia.phonemanagerapp&#10;&#10;import android.content.pm.PackageManager&#10;import android.graphics.Bitmap&#10;import android.graphics.Canvas&#10;import android.graphics.drawable.BitmapDrawable&#10;import android.graphics.drawable.Drawable&#10;import android.os.Bundle&#10;import androidx.activity.ComponentActivity&#10;import androidx.activity.compose.setContent&#10;import androidx.activity.enableEdgeToEdge&#10;import androidx.compose.foundation.Image&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.lazy.LazyColumn&#10;import androidx.compose.foundation.lazy.items&#10;import androidx.compose.material3.AlertDialog&#10;import androidx.compose.material3.Button&#10;import androidx.compose.material3.MaterialTheme&#10;import androidx.compose.material3.Scaffold&#10;import androidx.compose.material3.Text&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.graphics.asImageBitmap&#10;import androidx.compose.ui.layout.ContentScale&#10;import androidx.compose.ui.platform.LocalContext&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.unit.dp&#10;import androidx.compose.ui.unit.sp&#10;import com.achacynthia.phonemanagerapp.ui.theme.PhoneManagerAppTheme&#10;import kotlinx.coroutines.Dispatchers&#10;import kotlinx.coroutines.withContext&#10;&#10;// Simple data holder for app information&#10;data class AppInfo(&#10;    val packageName: String,&#10;    val label: String,&#10;    val versionName: String?,&#10;    val permissions: List&lt;String&gt;,&#10;    val isSystemApp: Boolean,&#10;    val iconBitmap: androidx.compose.ui.graphics.ImageBitmap?&#10;)&#10;&#10;class MainActivity : ComponentActivity() {&#10;    override fun onCreate(savedInstanceState: Bundle?) {&#10;        super.onCreate(savedInstanceState)&#10;        enableEdgeToEdge()&#10;        setContent {&#10;            PhoneManagerAppTheme {&#10;                Scaffold { innerPadding -&gt;&#10;                    Box(modifier = Modifier&#10;                        .fillMaxSize()&#10;                        .padding(innerPadding)) {&#10;                        AppList()&#10;                    }&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun AppList() {&#10;    val context = LocalContext.current&#10;    val pm = context.packageManager&#10;&#10;    var apps by remember { mutableStateOf&lt;List&lt;AppInfo&gt;&gt;(emptyList()) }&#10;    var selectedApp by remember { mutableStateOf&lt;AppInfo?&gt;(null) }&#10;&#10;    // Load apps once on composition&#10;    LaunchedEffect(Unit) {&#10;        apps = loadInstalledApps(pm)&#10;    }&#10;&#10;    LazyColumn(&#10;        modifier = Modifier&#10;            .fillMaxSize()&#10;            .padding(8.dp),&#10;        verticalArrangement = Arrangement.spacedBy(8.dp)&#10;    ) {&#10;        items(apps) { app -&gt;&#10;            Row(&#10;                modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .padding(8.dp),&#10;                verticalAlignment = Alignment.CenterVertically,&#10;                horizontalArrangement = Arrangement.SpaceBetween&#10;            ) {&#10;                Row(verticalAlignment = Alignment.CenterVertically) {&#10;                    if (app.iconBitmap != null) {&#10;                        Image(&#10;                            bitmap = app.iconBitmap,&#10;                            contentDescription = &quot;${app.label} icon&quot;,&#10;                            modifier = Modifier.size(48.dp),&#10;                            contentScale = ContentScale.Fit&#10;                        )&#10;                    } else {&#10;                        Box(modifier = Modifier.size(48.dp))&#10;                    }&#10;&#10;                    Spacer(modifier = Modifier.width(12.dp))&#10;&#10;                    Column {&#10;                        Text(text = app.label, fontSize = 16.sp, fontWeight = FontWeight.Bold)&#10;                        Text(text = app.packageName, style = MaterialTheme.typography.bodySmall)&#10;                    }&#10;                }&#10;&#10;                Button(onClick = { selectedApp = app }) {&#10;                    Text(text = &quot;LEARN more&quot;)&#10;                }&#10;            }&#10;        }&#10;    }&#10;&#10;    if (selectedApp != null) {&#10;        val a = selectedApp!!&#10;        AlertDialog(&#10;            onDismissRequest = { selectedApp = null },&#10;            confirmButton = {&#10;                Button(onClick = { selectedApp = null }) { Text(&quot;Close&quot;) }&#10;            },&#10;            title = { Text(text = a.label) },&#10;            text = {&#10;                val perms = if (a.permissions.isEmpty()) &quot;None&quot; else a.permissions.joinToString(&quot;\n&quot;)&#10;                Column {&#10;                    Text(text = &quot;Package: ${a.packageName}&quot;)&#10;                    Text(text = &quot;Version: ${a.versionName ?: &quot;unknown&quot;}&quot;)&#10;                    Text(text = &quot;System app: ${a.isSystemApp}&quot;)&#10;                    Spacer(modifier = Modifier.height(8.dp))&#10;                    Text(text = &quot;Permissions:&quot;)&#10;                    Text(text = perms)&#10;                }&#10;            }&#10;        )&#10;    }&#10;}&#10;&#10;suspend fun loadInstalledApps(pm: PackageManager): List&lt;AppInfo&gt; = withContext(Dispatchers.IO) {&#10;    val out = mutableListOf&lt;AppInfo&gt;()&#10;    val packages = pm.getInstalledPackages(PackageManager.GET_PERMISSIONS)&#10;&#10;    for (pkg in packages) {&#10;        try {&#10;            // package.applicationInfo may be nullable in some analysis contexts - guard it&#10;            val ai = pkg.applicationInfo ?: continue&#10;            val label = ai.loadLabel(pm).toString()&#10;&#10;            // Try to read version name safely&#10;            val versionName = try {&#10;                val pInfo = pm.getPackageInfo(pkg.packageName, 0)&#10;                pInfo.versionName&#10;            } catch (_: Exception) {&#10;                null&#10;            }&#10;&#10;            val requested = pkg.requestedPermissions?.toList() ?: emptyList()&#10;            val isSystem = (ai.flags and android.content.pm.ApplicationInfo.FLAG_SYSTEM) != 0&#10;&#10;            val drawable = try { ai.loadIcon(pm) } catch (_: Exception) { null }&#10;            val bitmap = drawable?.let { drawableToBitmap(it).asImageBitmap() }&#10;&#10;            out += AppInfo(&#10;                packageName = pkg.packageName,&#10;                label = label,&#10;                versionName = versionName,&#10;                permissions = requested,&#10;                isSystemApp = isSystem,&#10;                iconBitmap = bitmap&#10;            )&#10;        } catch (_: Exception) {&#10;            // skip packages we can't read&#10;        }&#10;    }&#10;&#10;    out.sortedBy { it.label.lowercase() }&#10;}&#10;&#10;fun drawableToBitmap(drawable: Drawable): Bitmap {&#10;    if (drawable is BitmapDrawable) {&#10;        drawable.bitmap?.let { return it }&#10;    }&#10;    val width = if (drawable.intrinsicWidth &gt; 0) drawable.intrinsicWidth else 1&#10;    val height = if (drawable.intrinsicHeight &gt; 0) drawable.intrinsicHeight else 1&#10;    val bitmap = Bitmap.createBitmap(width, height, Bitmap.Config.ARGB_8888)&#10;    val canvas = Canvas(bitmap)&#10;    drawable.setBounds(0, 0, canvas.width, canvas.height)&#10;    drawable.draw(canvas)&#10;    return bitmap&#10;}" />
              <option name="updatedContent" value="package com.achacynthia.phonemanagerapp&#10;&#10;import android.content.pm.PackageManager&#10;import android.graphics.Bitmap&#10;import android.graphics.Canvas&#10;import android.graphics.drawable.BitmapDrawable&#10;import android.graphics.drawable.Drawable&#10;import android.os.Bundle&#10;import androidx.activity.ComponentActivity&#10;import androidx.activity.compose.setContent&#10;import androidx.activity.enableEdgeToEdge&#10;import androidx.compose.foundation.Image&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.lazy.LazyColumn&#10;import androidx.compose.foundation.lazy.items&#10;import androidx.compose.foundation.lazy.rememberLazyListState&#10;import androidx.compose.material3.AlertDialog&#10;import androidx.compose.material3.Button&#10;import androidx.compose.material3.Card&#10;import androidx.compose.material3.MaterialTheme&#10;import androidx.compose.material3.Scaffold&#10;import androidx.compose.material3.OutlinedTextField&#10;import androidx.compose.material3.IconButton&#10;import androidx.compose.material3.Text&#10;import androidx.compose.runtime.*&#10;import androidx.compose.runtime.rememberCoroutineScope&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.graphics.asImageBitmap&#10;import androidx.compose.ui.layout.ContentScale&#10;import androidx.compose.ui.platform.LocalContext&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.unit.dp&#10;import androidx.compose.ui.unit.sp&#10;import com.achacynthia.phonemanagerapp.ui.theme.PhoneManagerAppTheme&#10;import kotlinx.coroutines.Dispatchers&#10;import kotlinx.coroutines.withContext&#10;import kotlinx.coroutines.launch&#10;&#10;// Simple data holder for app information&#10;data class AppInfo(&#10;    val packageName: String,&#10;    val label: String,&#10;    val versionName: String?,&#10;    val permissions: List&lt;String&gt;,&#10;    val isSystemApp: Boolean,&#10;    val iconBitmap: androidx.compose.ui.graphics.ImageBitmap?&#10;)&#10;&#10;class MainActivity : ComponentActivity() {&#10;    override fun onCreate(savedInstanceState: Bundle?) {&#10;        super.onCreate(savedInstanceState)&#10;        enableEdgeToEdge()&#10;        setContent {&#10;            PhoneManagerAppTheme {&#10;                Scaffold { innerPadding -&gt;&#10;                    Box(modifier = Modifier&#10;                        .fillMaxSize()&#10;                        .padding(innerPadding)) {&#10;                        AppList()&#10;                    }&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;@Composable&#10;fun AppList() {&#10;    val context = LocalContext.current&#10;    val pm = context.packageManager&#10;&#10;    var apps by remember { mutableStateOf&lt;List&lt;AppInfo&gt;&gt;(emptyList()) }&#10;    var selectedApp by remember { mutableStateOf&lt;AppInfo?&gt;(null) }&#10;    var query by remember { mutableStateOf(&quot;&quot;) }&#10;&#10;    // List state to allow programmatic scrolling&#10;    val listState = rememberLazyListState()&#10;    val coroutineScope = rememberCoroutineScope()&#10;&#10;    // Load apps once on composition&#10;    LaunchedEffect(Unit) {&#10;        apps = loadInstalledApps(pm)&#10;    }&#10;&#10;    // When query changes, scroll to the first matching item (if any)&#10;    LaunchedEffect(query, apps) {&#10;        if (query.isNotBlank()) {&#10;            val idx = apps.indexOfFirst { it.label.contains(query, ignoreCase = true) || it.packageName.contains(query, ignoreCase = true) }&#10;            if (idx &gt;= 0) {&#10;                // animate to the found item&#10;                listState.animateScrollToItem(idx)&#10;            }&#10;        }&#10;    }&#10;&#10;    Column(modifier = Modifier.fillMaxSize()) {&#10;        // H1 heading at the top&#10;        Text(&#10;            text = &quot;Welcome! Learn more about the apps in your phone&quot;,&#10;            style = MaterialTheme.typography.headlineLarge,&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .padding(vertical = 12.dp, horizontal = 16.dp),&#10;            textAlign = androidx.compose.ui.text.style.TextAlign.Center&#10;        )&#10;&#10;        // Search bar at top (always visible)&#10;        OutlinedTextField(&#10;            value = query,&#10;            onValueChange = { query = it },&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .padding(8.dp),&#10;            placeholder = { androidx.compose.material3.Text(text = &quot;Search apps by name or package&quot;) },&#10;            leadingIcon = { androidx.compose.material3.Text(text = &quot;&quot;) },&#10;            trailingIcon = {&#10;                if (query.isNotEmpty()) {&#10;                    IconButton(onClick = { query = &quot;&quot; }) {&#10;                        Text(text = &quot;Clear&quot;)&#10;                    }&#10;                }&#10;            },&#10;        )&#10;&#10;        // Always show the full list; highlight matches instead of hiding others&#10;        LazyColumn(&#10;            state = listState,&#10;            modifier = Modifier&#10;                .fillMaxSize()&#10;                .padding(8.dp),&#10;            verticalArrangement = Arrangement.spacedBy(8.dp)&#10;        ) {&#10;            items(apps) { app -&gt;&#10;                val isMatch = query.isNotBlank() &amp;&amp; (app.label.contains(query, ignoreCase = true) || app.packageName.contains(query, ignoreCase = true))&#10;&#10;                Card(&#10;                    modifier = Modifier&#10;                        .fillMaxWidth()&#10;                        .padding(4.dp),&#10;                ) {&#10;                    Column(modifier = Modifier&#10;                        .fillMaxWidth()&#10;                        .padding(12.dp)) {&#10;                        Row(verticalAlignment = Alignment.CenterVertically) {&#10;                            if (app.iconBitmap != null) {&#10;                                Image(&#10;                                    bitmap = app.iconBitmap,&#10;                                    contentDescription = &quot;${app.label} icon&quot;,&#10;                                    modifier = Modifier.size(64.dp),&#10;                                    contentScale = ContentScale.Fit&#10;                                )&#10;                            } else {&#10;                                Box(modifier = Modifier.size(64.dp))&#10;                            }&#10;&#10;                            Spacer(modifier = Modifier.width(12.dp))&#10;&#10;                            Column {&#10;                                // Highlight the app name when it matches the query&#10;                                Text(&#10;                                    text = app.label,&#10;                                    fontSize = 18.sp,&#10;                                    fontWeight = FontWeight.Bold,&#10;                                    color = if (isMatch) MaterialTheme.colorScheme.primary else MaterialTheme.colorScheme.onBackground&#10;                                )&#10;                                Spacer(modifier = Modifier.height(4.dp))&#10;                                Text(text = app.packageName, style = MaterialTheme.typography.bodySmall)&#10;                            }&#10;                        }&#10;&#10;                        Spacer(modifier = Modifier.height(12.dp))&#10;&#10;                        // Button remains at bottom-right&#10;                        Row(modifier = Modifier.fillMaxWidth(), horizontalArrangement = Arrangement.End) {&#10;                            Button(onClick = { selectedApp = app }) {&#10;                                Text(text = &quot;LEARN more&quot;)&#10;                            }&#10;                        }&#10;                    }&#10;                }&#10;            }&#10;        }&#10;    }&#10;&#10;    if (selectedApp != null) {&#10;        val a = selectedApp!!&#10;        AlertDialog(&#10;            onDismissRequest = { selectedApp = null },&#10;            confirmButton = {&#10;                Button(onClick = { selectedApp = null }) { Text(&quot;Close&quot;) }&#10;            },&#10;            title = { Text(text = a.label) },&#10;            text = {&#10;                val perms = if (a.permissions.isEmpty()) &quot;None&quot; else a.permissions.joinToString(&quot;\n&quot;)&#10;                Column {&#10;                    Text(text = &quot;Package: ${a.packageName}&quot;)&#10;                    Text(text = &quot;Version: ${a.versionName ?: &quot;unknown&quot;}&quot;)&#10;                    Text(text = &quot;System app: ${a.isSystemApp}&quot;)&#10;                    Spacer(modifier = Modifier.height(8.dp))&#10;                    Text(text = &quot;Permissions:&quot;)&#10;                    Text(text = perms)&#10;                }&#10;            }&#10;        )&#10;    }&#10;}&#10;&#10;suspend fun loadInstalledApps(pm: PackageManager): List&lt;AppInfo&gt; = withContext(Dispatchers.IO) {&#10;    val out = mutableListOf&lt;AppInfo&gt;()&#10;    val packages = pm.getInstalledPackages(PackageManager.GET_PERMISSIONS)&#10;&#10;    for (pkg in packages) {&#10;        try {&#10;            // package.applicationInfo may be nullable in some analysis contexts - guard it&#10;            val ai = pkg.applicationInfo ?: continue&#10;            val label = ai.loadLabel(pm).toString()&#10;&#10;            // Try to read version name safely&#10;            val versionName = try {&#10;                val pInfo = pm.getPackageInfo(pkg.packageName, 0)&#10;                pInfo.versionName&#10;            } catch (_: Exception) {&#10;                null&#10;            }&#10;&#10;            val requested = pkg.requestedPermissions?.toList() ?: emptyList()&#10;            val isSystem = (ai.flags and android.content.pm.ApplicationInfo.FLAG_SYSTEM) != 0&#10;&#10;            val drawable = try { ai.loadIcon(pm) } catch (_: Exception) { null }&#10;            val bitmap = drawable?.let { drawableToBitmap(it).asImageBitmap() }&#10;&#10;            out += AppInfo(&#10;                packageName = pkg.packageName,&#10;                label = label,&#10;                versionName = versionName,&#10;                permissions = requested,&#10;                isSystemApp = isSystem,&#10;                iconBitmap = bitmap&#10;            )&#10;        } catch (_: Exception) {&#10;            // skip packages we can't read&#10;        }&#10;    }&#10;&#10;    out.sortedBy { it.label.lowercase() }&#10;}&#10;&#10;fun drawableToBitmap(drawable: Drawable): Bitmap {&#10;    if (drawable is BitmapDrawable) {&#10;        drawable.bitmap?.let { return it }&#10;    }&#10;    val width = if (drawable.intrinsicWidth &gt; 0) drawable.intrinsicWidth else 1&#10;    val height = if (drawable.intrinsicHeight &gt; 0) drawable.intrinsicHeight else 1&#10;    val bitmap = Bitmap.createBitmap(width, height, Bitmap.Config.ARGB_8888)&#10;    val canvas = Canvas(bitmap)&#10;    drawable.setBounds(0, 0, canvas.width, canvas.height)&#10;    drawable.draw(canvas)&#10;    return bitmap&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>